{% extends 'base.html' %}
{% block content %}

<style>
    .stat-card {
        border-radius: 18px;
        padding: 25px;
        color: #fff;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.15);
    }
    .bg-primary-custom { background: #4a90e2; }
    .bg-success-custom { background: #50c878; }
    .bg-danger-custom  { background: #e64c4c; }
    .section-title { font-weight: 700; font-size: 22px; }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-bold">ðŸ“Š Admin â€” Voting Dashboard</h2>
    <div>
        <a class="btn btn-success" href="{{ url_for('views.export_results') }}">
            <i class="fa fa-file-csv"></i> Download CSV
        </a>
        <a class="btn btn-secondary" href="{{ url_for('views.index') }}">Back</a>
    </div>
</div>

<!-- STAT CARDS -->
<div class="row g-4 mb-4">

    <!-- Total Votes -->
    <div class="col-md-4">
        <div class="stat-card bg-primary-custom">
            <h5>Total Votes</h5>
            <h2>{{ total }}</h2>
        </div>
    </div>

    <!-- Each Party -->
    {% for party, v in counts.items() %}
    <div class="col-md-4">
        <div class="stat-card bg-success-custom">
            <h5>{{ party }}</h5>
            <h2>{{ v }}</h2>
        </div>
    </div>
    {% endfor %}

</div>

<!-- TABLE + CHART CARD -->
<div class="card mb-3 shadow-sm">
    <div class="card-body">
        <h4 class="section-title">ðŸ“‹ Vote Summary Table</h4>

        {% if counts %}
        <div class="table-responsive mt-3">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Political Party</th>
                        <th>Total Votes</th>
                    </tr>
                </thead>
                <tbody>
                {% for party, v in counts.items() %}
                    <tr>
                        <td>{{ party }}</td>
                        <td>{{ v }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Chart -->
        <h4 class="section-title mt-4">ðŸ“Š Vote Distribution</h4>
        <canvas id="resultsChart" height="120"></canvas>

        {% else %}
            <p class="text-muted mt-3">No votes recorded yet.</p>
        {% endif %}
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    fetch("{{ url_for('views.results_json') }}")
        .then(r => r.json())
        .then(data => {
            if (!data || !data.counts) return;

            const labels = Object.keys(data.counts);
            const values = Object.values(data.counts);

            new Chart(document.getElementById('resultsChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Votes',
                        data: values,
                        backgroundColor: [
                            '#4a90e2',
                            '#50c878',
                            '#e64c4c',
                            '#ffb400',
                            '#8e44ad'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        })
        .catch(err => console.error("Chart load error:", err));
});
</script>

{% endblock %}
